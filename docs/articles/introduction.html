<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to ZeitZeiger • zeitzeiger</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to ZeitZeiger">
<meta property="og:description" content="zeitzeiger">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">zeitzeiger</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/zeitzeiger.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/introduction.html">Introduction to ZeitZeiger</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hugheylab/zeitzeiger/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to ZeitZeiger</h1>
                        <h4 class="author">Jake Hughey</h4>
            
            <h4 class="date">2020-05-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hugheylab/zeitzeiger/blob/master/vignettes/introduction.Rmd"><code>vignettes/introduction.Rmd</code></a></small>
      <div class="hidden name"><code>introduction.Rmd</code></div>

    </div>

    
    
<p>ZeitZeiger is a method for supervised learning on high-dimensional data from an oscillatory system. This vignette goes through an example of how to use ZeitZeiger to train and test a predictor, perform cross-validation, and plot the results.</p>
<div id="load-the-necessary-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-the-necessary-packages" class="anchor"></a>Load the necessary packages</h2>
<p>First let’s load the necessary packages.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">'doParallel'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">'dplyr'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">'ggplot2'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">'tidyr'</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">'zeitzeiger'</span>)</pre></body></html></div>
</div>
<div id="generate-example-data" class="section level2">
<h2 class="hasAnchor">
<a href="#generate-example-data" class="anchor"></a>Generate example data</h2>
<p>Now we’ll simulate data from an oscillatory system. Our simulated data will have 100 observations, with measurements of 200 features and 10 time-points per period. Each feature will have Gaussian noise. We’ll call the periodic variable here “time,” which will go between 0 and 1.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">nObs</span> <span class="kw">=</span> <span class="fl">100</span>
<span class="no">nFeatures</span> <span class="kw">=</span> <span class="fl">200</span>
<span class="no">amp</span> <span class="kw">=</span> <span class="fl">0.5</span>

<span class="no">time</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>((<span class="fl">0</span>:<span class="fl">9</span>) / <span class="fl">10</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="no">nObs</span>)
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">42</span>)
<span class="no">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="no">nObs</span>*<span class="no">nFeatures</span>, <span class="kw">sd</span> <span class="kw">=</span> <span class="fl">0.7</span>), <span class="kw">nrow</span> <span class="kw">=</span> <span class="no">nObs</span>)</pre></body></html></div>
<p>The oscillator will produce three patterns: a sine, a cosine, and a cosine with twice the frequency. For each of the three patterns, two features will have relatively strong signal and eight more will have relatively weak signal.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">baseSignal</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span>(<span class="no">time</span> * <span class="fl">2</span> * <span class="no">pi</span>)
<span class="no">x</span>[, <span class="fl">1</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="fl">1</span>] + <span class="fl">3</span> * <span class="no">baseSignal</span>
<span class="no">x</span>[, <span class="fl">2</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="fl">2</span>] - <span class="fl">0.5</span> * <span class="no">baseSignal</span>
<span class="kw">for</span> (<span class="no">ii</span> <span class="kw">in</span> <span class="fl">3</span>:<span class="fl">10</span>) {
  <span class="no">x</span>[, <span class="no">ii</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="no">ii</span>] + <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">1</span>, -<span class="no">amp</span>, <span class="no">amp</span>) * <span class="no">baseSignal</span>}

<span class="no">baseSignal</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(<span class="no">time</span> * <span class="fl">2</span> * <span class="no">pi</span>)
<span class="no">x</span>[, <span class="fl">11</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="fl">11</span>] + <span class="fl">2</span> * <span class="no">baseSignal</span>
<span class="no">x</span>[, <span class="fl">12</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="fl">12</span>] - <span class="no">baseSignal</span>
<span class="kw">for</span> (<span class="no">ii</span> <span class="kw">in</span> <span class="fl">13</span>:<span class="fl">20</span>) {
  <span class="no">x</span>[, <span class="no">ii</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="no">ii</span>] + <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">1</span>, -<span class="no">amp</span>, <span class="no">amp</span>) * <span class="no">baseSignal</span>}

<span class="no">baseSignal</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(<span class="no">time</span> * <span class="fl">4</span> * <span class="no">pi</span> + <span class="no">pi</span> / <span class="fl">6</span>)
<span class="no">x</span>[, <span class="fl">21</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="fl">21</span>] + <span class="no">baseSignal</span>
<span class="no">x</span>[, <span class="fl">22</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="fl">22</span>] - <span class="no">baseSignal</span>
<span class="kw">for</span> (<span class="no">ii</span> <span class="kw">in</span> <span class="fl">23</span>:<span class="fl">30</span>) {
  <span class="no">x</span>[, <span class="no">ii</span>] <span class="kw">=</span> <span class="no">x</span>[, <span class="no">ii</span>] + <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span>(<span class="fl">1</span>, -<span class="no">amp</span>, <span class="no">amp</span>) * <span class="no">baseSignal</span>}</pre></body></html></div>
</div>
<div id="create-training-and-testing-observations" class="section level2">
<h2 class="hasAnchor">
<a href="#create-training-and-testing-observations" class="anchor"></a>Create training and testing observations</h2>
<p>Now we’ll split the dataset into training and test sets.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">idxTrain</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="no">nObs</span> * <span class="fl">0.6</span>)

<span class="no">xTrain</span> <span class="kw">=</span> <span class="no">x</span>[<span class="no">idxTrain</span>, ]
<span class="no">timeTrain</span> <span class="kw">=</span> <span class="no">time</span>[<span class="no">idxTrain</span>]

<span class="no">xTest</span> <span class="kw">=</span> <span class="no">x</span>[-<span class="no">idxTrain</span>, ]
<span class="no">timeTest</span> <span class="kw">=</span> <span class="no">time</span>[-<span class="no">idxTrain</span>]</pre></body></html></div>
</div>
<div id="train-and-test-a-zeitzeiger-predictor" class="section level2">
<h2 class="hasAnchor">
<a href="#train-and-test-a-zeitzeiger-predictor" class="anchor"></a>Train and test a ZeitZeiger predictor</h2>
<p>ZeitZeiger has three main steps: <code>zeitzeigerFit</code>, <code>zeitzeigerSpc</code>, and <code>zeitzeigerPredict</code>. Each function has several options, please see the help and Hughey et al. (2016) for more details. The preferred way to use them is to call each function separately. This lets you change the parameters for a later step without re-running the earlier steps.</p>
<p><code>zeitzeigerFit</code> uses the training data to fit a periodic smoothing spline to the behavior of each feature as a function of time. <code>zeitzeigerSpc</code> then uses the spline fits to calculate sparse principal components (SPCs) for how the features change over time. <code>zeitzeigerPredict</code> then uses the training data and the SPCs to predict the corresponding time for each test observation. The two main parameters of ZeitZeiger are <code>sumabsv</code>, which controls the amount of regularization, and <code>nSPC</code>, which controls how many SPCs are used for prediction.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">fitResult</span> <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerFit.html">zeitzeigerFit</a></span>(<span class="no">xTrain</span>, <span class="no">timeTrain</span>)
<span class="no">spcResult</span> <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerSpc.html">zeitzeigerSpc</a></span>(<span class="no">fitResult</span>$<span class="no">xFitMean</span>, <span class="no">fitResult</span>$<span class="no">xFitResid</span>, <span class="kw">sumabsv</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="no">predResult</span> <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerPredict.html">zeitzeigerPredict</a></span>(<span class="no">xTrain</span>, <span class="no">timeTrain</span>, <span class="no">xTest</span>, <span class="no">spcResult</span>, <span class="kw">nSpc</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
<p>Alternatively, you can run all three steps in one go using the <code>zeitzeiger</code> function, which returns a list consisting of the results of the above three functions.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">zzFit</span> <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeiger.html">zeitzeiger</a></span>(<span class="no">xTrain</span>, <span class="no">timeTrain</span>, <span class="no">xTest</span>, <span class="kw">sumabsv</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">nSpc</span> <span class="kw">=</span> <span class="fl">2</span>)</pre></body></html></div>
</div>
<div id="plot-the-periodic-spline-fits" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-periodic-spline-fits" class="anchor"></a>Plot the periodic spline fits</h2>
<p>Before looking at the predictions, it’s a good idea to check the quality of the spline fits.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">timeRange</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">0</span>, <span class="fl">1</span> - <span class="fl">0.01</span>, <span class="fl">0.01</span>)
<span class="no">jj</span> <span class="kw">=</span> <span class="fl">11</span>

<span class="no">df1</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">timeTrain</span>, <span class="kw">xTrain</span> <span class="kw">=</span> <span class="no">xTrain</span>[, <span class="no">jj</span>])
<span class="no">df2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">timeRange</span>,
                 <span class="kw">xPred</span> <span class="kw">=</span> <span class="fu"><a href="../reference/predictIntensity.html">predictIntensity</a></span>(<span class="no">fitResult</span>$<span class="no">xFitMean</span>[<span class="no">jj</span>, , <span class="kw">drop</span> <span class="kw">=</span> <span class="fl">FALSE</span>],
                                          <span class="no">timeRange</span>),
                 <span class="kw">xObs</span> <span class="kw">=</span> <span class="fl">2</span> * <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span>(<span class="no">timeRange</span> * <span class="fl">2</span> * <span class="no">pi</span>)) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="kw">key</span> <span class="kw">=</span> <span class="no">key</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">value</span>, -<span class="no">timeRange</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">key</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">key</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'xObs'</span>, <span class="st">'xPred'</span>),
                      <span class="kw">labels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Observed mean'</span>, <span class="st">'Predicted mean'</span>)))</pre></body></html></div>
<p>For feature 11, the fit looks good. In a real-world dataset, we wouldn’t know the observed mean, so we could only compare the predicted mean to the observations.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timeTrain</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">xTrain</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">df1</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timeRange</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">value</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="no">key</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">df2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Time'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">'Feature %d'</span>, <span class="no">jj</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.5</span>, <span class="fl">0.85</span>), <span class="kw">legend.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())</pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-9-1.png" width="384"></p>
</div>
<div id="plot-prediction-error-on-the-test-set" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-prediction-error-on-the-test-set" class="anchor"></a>Plot prediction error on the test set</h2>
<p>We can calculate the difference between predicted time and observed time, i.e., the error, using <code>getCircDiff</code>. This function accounts for the fact that time is periodic, so <code>time = 0</code> is equivalent to <code>time = 1</code>. The error can range from -0.5 to 0.5.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">dfTest</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">timeObs</span> <span class="kw">=</span> <span class="no">timeTest</span>,
                    <span class="kw">timePred</span> <span class="kw">=</span> <span class="no">predResult</span>$<span class="no">timePred</span>,
                    <span class="kw">timeError</span> <span class="kw">=</span> <span class="fu"><a href="../reference/getCircDiff.html">getCircDiff</a></span>(<span class="no">predResult</span>$<span class="no">timePred</span>, <span class="no">timeTest</span>))</pre></body></html></div>
<p>There are many ways to examine prediction accuracy. A simple one is to plot predicted time vs. observed time. Ideally, all points would lie on the line <code>y = x</code>. These predictions are pretty good. A couple test observations with an observed time of 0 have a predicted time slightly less than 1, which is ok.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">dfTest</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timeObs</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">timePred</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span>(<span class="kw">slope</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">intercept</span> <span class="kw">=</span> <span class="fl">0</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="st">'dashed'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>)) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Observed time'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Predicted time'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-11-1.png" width="336"></p>
<p>When we plot error vs. observed time, we see those observations have a small negative error.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">dfTest</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timeObs</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">timeError</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">0.2</span>, <span class="fl">0.2</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Observed time'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Error'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-12-1.png" width="336"></p>
</div>
<div id="plot-a-test-observations-time-dependent-likelihood" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-a-test-observations-time-dependent-likelihood" class="anchor"></a>Plot a test observation’s time-dependent likelihood</h2>
<p>The predicted time for a test observation is the time with maximum likelihood. Another output of <code>zeitzeigerPredict</code>, however, is the likelihood across the entire range of time. By default, this likelihood is calculated at 100 discrete time-points, the same as <code>timeRange</code> that we defined earlier (the predicted time is not restricted to being one of these time-points).</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">obs</span> <span class="kw">=</span> <span class="fl">2</span>
<span class="no">dfLike</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">timeRange</span>, <span class="kw">likelihood</span> <span class="kw">=</span> <span class="no">predResult</span>$<span class="no">timeDepLike</span>[<span class="no">obs</span>, <span class="fl">1</span>, ])

<span class="no">dfVert</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">type</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'Observed time'</span>, <span class="st">'Predicted time'</span>),
                    <span class="kw">xint</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">timeTest</span>[<span class="no">obs</span>], <span class="no">predResult</span>$<span class="no">timePred</span>[<span class="no">obs</span>]))</pre></body></html></div>
<p>For this observation, notice how the likelihood starts increasing at times slightly less than 1, then continues to increase at times greater than 0.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">dfLike</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">timeRange</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">likelihood</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">xintercept</span> <span class="kw">=</span> <span class="no">xint</span>, <span class="kw">linetype</span> <span class="kw">=</span> <span class="no">type</span>), <span class="kw">data</span> <span class="kw">=</span> <span class="no">dfVert</span>,
             <span class="kw">show.legend</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_linetype_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'solid'</span>, <span class="st">'dashed'</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Time'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Likelihood'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.7</span>, <span class="fl">0.8</span>), <span class="kw">legend.title</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span>())</pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-14-1.png" width="384"></p>
</div>
<div id="run-cross-validation" class="section level2">
<h2 class="hasAnchor">
<a href="#run-cross-validation" class="anchor"></a>Run cross-validation</h2>
<p>To determine the best parameters for training a ZeitZeiger predictor, we can run cross-validation. The cross-validation functions can process the folds in parallel, if <code>registerDoParallel</code> is called beforehand. Because the three steps of ZeitZeiger are separated, we need to first randomly assign each observation to a fold, then use the same assignments for <code>zeitzeigerFitCv</code> and <code>zeitzeigerPredictCv</code>.</p>
<p>Here we’ll run cross-validation over three values of <code>sumabsv</code> and four values of <code>nSPC</code>. Typically a few values of <code>sumabsv</code> will suffice, and <code>nSPC</code> in this example can only range from 1 to 10 (because 10 is the default value of <code>nTime</code>).</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/doParallel/man/registerDoParallel.html">registerDoParallel</a></span>(<span class="kw">cores</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="no">sumabsv</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">3</span>)
<span class="no">nSpc</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">4</span>
<span class="no">nFolds</span> <span class="kw">=</span> <span class="fl">10</span>
<span class="no">foldid</span> <span class="kw">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample.html">sample</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">nFolds</span>, <span class="kw">length.out</span> <span class="kw">=</span> <span class="no">nObs</span>))

<span class="no">fitResultList</span> <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerFitCv.html">zeitzeigerFitCv</a></span>(<span class="no">x</span>, <span class="no">time</span>, <span class="no">foldid</span>)

<span class="no">spcResultList</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">ii</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sumabsv</span>)) {
  <span class="no">spcResultList</span><span class="kw">[[</span><span class="no">ii</span>]] <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerSpcCv.html">zeitzeigerSpcCv</a></span>(<span class="no">fitResultList</span>, <span class="kw">sumabsv</span> <span class="kw">=</span> <span class="no">sumabsv</span>[<span class="no">ii</span>])}

<span class="no">predResultList</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">ii</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sumabsv</span>)) {
  <span class="no">predResultList</span><span class="kw">[[</span><span class="no">ii</span>]] <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerPredictCv.html">zeitzeigerPredictCv</a></span>(<span class="no">x</span>, <span class="no">time</span>, <span class="no">foldid</span>,
                                             <span class="no">spcResultList</span><span class="kw">[[</span><span class="no">ii</span>]], <span class="kw">nSpc</span> <span class="kw">=</span> <span class="no">nSpc</span>)}</pre></body></html></div>
</div>
<div id="plot-the-error-for-each-set-of-parameter-values" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-error-for-each-set-of-parameter-values" class="anchor"></a>Plot the error for each set of parameter values</h2>
<p>Before plotting, we need to reorganize the output, making a <code>data.frame</code> with the information for each prediction.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">timePredList</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">predResultList</span>, <span class="kw">function</span>(<span class="no">a</span>) <span class="no">a</span>$<span class="no">timePred</span>)

<span class="no">cvResult</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">rbind</span>, <span class="no">timePredList</span>),
                      <span class="kw">timeObs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">time</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sumabsv</span>)),
                      <span class="kw">sumabsv</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="no">sumabsv</span>, <span class="kw">each</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">time</span>)),
                      <span class="kw">obs</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>:<span class="no">nObs</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">sumabsv</span>)),
                      <span class="kw">stringsAsFactors</span> <span class="kw">=</span> <span class="fl">FALSE</span>)

<span class="no">cvResultGath</span> <span class="kw">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="no">cvResult</span>, <span class="kw">key</span> <span class="kw">=</span> <span class="no">nSpc</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">timePred</span>, -<span class="no">obs</span>, -<span class="no">timeObs</span>,
                      -<span class="no">sumabsv</span>)
<span class="no">cvResultGath</span>$<span class="no">nSpc</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">cvResultGath</span>$<span class="no">nSpc</span>),
                                      <span class="kw">function</span>(<span class="no">a</span>) <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="no">a</span>, <span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span>(<span class="no">a</span>))))
<span class="no">cvResultGath</span>$<span class="no">sumabsv</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">cvResultGath</span>$<span class="no">sumabsv</span>)
<span class="no">cvResultGath</span>$<span class="no">timeError</span> <span class="kw">=</span> <span class="fu"><a href="../reference/getCircDiff.html">getCircDiff</a></span>(<span class="no">cvResultGath</span>$<span class="no">timePred</span>, <span class="no">cvResultGath</span>$<span class="no">timeObs</span>)</pre></body></html></div>
<p>Now calculate the median absolute error for each set of parameter values.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">cvResultGathGroup</span> <span class="kw">=</span> <span class="no">cvResultGath</span> <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span>(<span class="no">sumabsv</span>, <span class="no">nSpc</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span>(<span class="kw">medae</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html">median</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">timeError</span>)))</pre></body></html></div>
<p>In this example dataset, the best accuracy seems to be at <code>sumabsv = 1</code> and <code>nSpc = 3</code>.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">cvResultGathGroup</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">nSpc</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">medae</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="no">sumabsv</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">sumabsv</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Number of SPCs'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Median absolute error'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.7</span>, <span class="fl">0.7</span>))</pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-18-1.png" width="288"></p>
</div>
<div id="train-a-model-on-the-full-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#train-a-model-on-the-full-dataset" class="anchor"></a>Train a model on the full dataset</h2>
<p>Now we can train a predictor on the full dataset using the almost optimal <code>sumabsv</code> (to keep things interesting) from cross-validation (all values of <code>nSpc</code> come along for free), and look at what ZeitZeiger has learned.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">fitResultFinal</span> <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerFit.html">zeitzeigerFit</a></span>(<span class="no">x</span>, <span class="no">time</span>)
<span class="no">spcResultFinal</span> <span class="kw">=</span> <span class="fu"><a href="../reference/zeitzeigerSpc.html">zeitzeigerSpc</a></span>(<span class="no">fitResultFinal</span>$<span class="no">xFitMean</span>, <span class="no">fitResultFinal</span>$<span class="no">xFitResid</span>,
                               <span class="kw">sumabsv</span> <span class="kw">=</span> <span class="fl">1.5</span>)

<span class="no">dfVar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">spc</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">spcResultFinal</span>$<span class="no">d</span>),
                   <span class="kw">propVar</span> <span class="kw">=</span> <span class="no">spcResultFinal</span>$<span class="no">d</span>^<span class="fl">2</span> / <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">spcResultFinal</span>$<span class="no">d</span>^<span class="fl">2</span>))</pre></body></html></div>
<p>Only the first three SPCs explain any appreciable amount of the variance in how the features change over time. This makes sense, as accuracy stopped improving or got worse at <code>nSpc = 4</code>.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">dfVar</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">spc</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">propVar</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>, <span class="fl">10</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'SPC'</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="st">'Proportion of\nvariance explained'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
<div id="plot-the-behavior-of-the-spcs-over-time" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-behavior-of-the-spcs-over-time" class="anchor"></a>Plot the behavior of the SPCs over time</h2>
<p>Now we can project the observations from feature-space to SPC-space, to look at how the three SPCs behave over time.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">z</span> <span class="kw">=</span> <span class="no">x</span> <span class="kw">%*%</span> <span class="no">spcResultFinal</span>$<span class="no">v</span>[, <span class="fl">1</span>:<span class="fl">3</span>]
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">z</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'SPC 1'</span>, <span class="st">'SPC 2'</span>, <span class="st">'SPC 3'</span>)
<span class="no">zGath</span> <span class="kw">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">z</span>, <span class="kw">obs</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="no">nObs</span>, <span class="kw">Time</span> <span class="kw">=</span> <span class="no">time</span>, <span class="kw">check.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>),
               <span class="kw">key</span> <span class="kw">=</span> <span class="no">SPC</span>, <span class="kw">value</span> <span class="kw">=</span> <span class="no">Abundance</span>, -<span class="no">obs</span>, -<span class="no">Time</span>)</pre></body></html></div>
<p>We see that each SPC corresponds to one of the three signals that we created in the dataset. The signs are reversed, but that’s ok. So these are the patterns that ZeitZeiger was using to predict the time.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">zGath</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span>(<span class="no">SPC</span> ~ <span class="no">.</span>, <span class="kw">scales</span> <span class="kw">=</span> <span class="st">'free_y'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">Time</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Abundance</span>), <span class="kw">size</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">shape</span> <span class="kw">=</span> <span class="fl">1</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>()</pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-22-1.png" width="480"></p>
</div>
<div id="plot-the-coefficients-of-the-features-for-the-spcs" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-the-coefficients-of-the-features-for-the-spcs" class="anchor"></a>Plot the coefficients of the features for the SPCs</h2>
<p>Finally, we can look at which features contribute to which SPCs.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">v</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="no">spcResultFinal</span>$<span class="no">v</span>[, <span class="fl">1</span>:<span class="fl">3</span>])
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">v</span>) <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'SPC 1'</span>, <span class="st">'SPC 2'</span>, <span class="st">'SPC 3'</span>)
<span class="no">v</span> <span class="kw">=</span> <span class="no">v</span>[<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(<span class="no">v</span>, <span class="fl">1</span>, <span class="kw">function</span>(<span class="no">r</span>) <span class="fu"><a href="https://rdrr.io/r/base/any.html">any</a></span>(<span class="no">r</span> <span class="kw">!=</span> <span class="fl">0</span>)), ]
<span class="no">v</span>[<span class="no">v</span> <span class="kw">==</span> <span class="fl">0</span>] <span class="kw">=</span> <span class="fl">NA</span>
<span class="no">v</span> <span class="kw">=</span> <span class="no">v</span>[<span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(<span class="no">order</span>, <span class="no">v</span>), ]
<span class="no">v</span>$<span class="no">feature</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(<span class="no">v</span>)
<span class="no">vGath</span> <span class="kw">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span>(<span class="no">v</span>, <span class="kw">key</span><span class="kw">=</span><span class="no">spc</span>, <span class="kw">value</span><span class="kw">=</span><span class="no">Coefficient</span>, -<span class="no">feature</span>) <span class="kw">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="kw">feature</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">feature</span>, <span class="kw">levels</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="no">v</span>$<span class="no">feature</span>)))</pre></body></html></div>
<p>Sure enough, ZeitZeiger found all the features with strong signal. In addition, the sign and value of the coefficient for each feature in its respective SPC correspond to what we simulated.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">vGath</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~ <span class="no">spc</span>, <span class="kw">nrow</span> <span class="kw">=</span> <span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">feature</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">Coefficient</span>), <span class="kw">stat</span> <span class="kw">=</span> <span class="st">'identity'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="st">'Feature'</span>) + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html">coord_flip</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">panel.spacing</span> <span class="kw">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/reexports.html">unit</a></span>(<span class="fl">1.2</span>, <span class="st">'lines'</span>))
<span class="co">#&gt; Warning: Removed 50 rows containing missing values (position_stack).</span></pre></body></html></div>
<p><img src="introduction_files/figure-html/unnamed-chunk-24-1.png" width="480"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jake Hughey.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
